---
- hosts: all
  become: yes
  vars:
    java_package: "{{ java_version | default('java-17-openjdk-devel') }}"
  tasks:
    - name: Install basic tools
      ansible.builtin.dnf:
        name:
          - yum-utils
          - wget
          - git
          - python3
          - python3-pip
          - epel-release
          - curl
        state: present
        update_cache: true

    - name: Enable CRB repository
      ansible.builtin.shell:
        cmd: sudo dnf config-manager --set-enabled crb
      ignore_errors: yes

    - name: Update dnf cache
      ansible.builtin.dnf:
        update_cache: yes

    - name: Debug Java package choice
      ansible.builtin.debug:
        msg: "Installing Java package: {{ java_package }}"

    - name: Install Java based on environment variable
      ansible.builtin.dnf:
        name: "{{ java_package }}"
        state: present

    - name: Verify Java installation
      ansible.builtin.shell:
        cmd: java -version
      register: java_version_output

    - name: Display Java version
      ansible.builtin.debug:
        msg: "Java version installed: {{ java_version_output.stdout }}"
